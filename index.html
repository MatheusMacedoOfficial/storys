<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Funil Stories</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body,
      html {
        height: 100%;
        font-family: sans-serif;
        background-color: #000;
        color: #fff;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .story-container {
        position: relative;
        display: flex;
        flex-direction: column;
        justify-content: flex-end;
        align-items: center;
        height: 100vh;
        width: 100%;
        max-width: 480px;
        overflow: hidden;
        touch-action: pan-y;
      }

      .story-background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
        z-index: -1;
      }

      .story-video {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        z-index: -1;
        display: none;
      }

      .progress-bar {
        display: flex;
        gap: 4px;
        width: 100%;
        position: absolute;
        top: 20px;
        padding: 0 20px;
        z-index: 10;
      }

      .progress-segment {
        flex: 1;
        height: 4px;
        background-color: #333;
        border-radius: 2px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        width: 0%;
        background-color: #fff;
        -webkit-transition: width 5s linear;
        transition: width 5s linear;
      }

      .story-content {
        width: 100%;
        padding: 40px 20px 60px;
        font-size: 1.8rem;
        text-align: center;
        background: rgba(0, 0, 0, 0.6);
        z-index: 1;
        display: flex; /* Adicionado para flexbox */
        flex-direction: column; /* Conteúdo em coluna */
        justify-content: flex-end; /* Alinha o conteúdo ao final */
        align-items: center; /* Centraliza horizontalmente */
        flex-grow: 1; /* Permite que ocupe o espaço disponível */
      }

      .story-text {
        margin-bottom: 20px; /* Espaçamento entre texto e botão CTA */
      }

      .nav-buttons {
        position: absolute;
        top: 50%;
        left: 0;
        right: 0;
        display: flex;
        justify-content: space-between;
        padding: 0 20px;
        transform: translateY(-50%);
        z-index: 5;
      }

      .nav-buttons button {
        background-color: transparent;
        border: none;
        cursor: pointer;
      }

      .nav-buttons button svg {
        fill: #fff;
        width: 32px;
        height: 32px;
      }

      .cta-button {
        background-color: #fff;
        color: #000;
        font-weight: bold;
        padding: 15px 30px; /* Aumentei o padding para ser mais proeminente */
        border-radius: 8px; /* Ajustei o border-radius */
        display: inline-block;
        text-decoration: none; /* Remover sublinhado do link */
        font-size: 1.2rem; /* Tamanho da fonte do botão */
        margin-top: auto; /* Empurra o botão para o final do flex container */
      }

      /* Estilo para ocultar os botões de navegação lateral na última história */
      .hide-nav-buttons .nav-buttons {
        display: none;
      }

      /* Estilo para alinhar o botão CTA no centro */
      .cta-centered-container {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        padding-bottom: 30px; /* Ajuste para o espaçamento do rodapé */
      }

      @media (max-width: 600px) {
        .story-content {
          font-size: 1.4rem;
        }
        .cta-button {
          padding: 12px 25px;
          font-size: 1rem;
        }
      }
    </style>
  </head>
  <body>
    <div class="story-container" id="story-container">
      <div class="story-background" id="story-background"></div>
      <video
        class="story-video"
        id="story-video"
        muted
        autoplay
        playsinline
      ></video>
      <div class="progress-bar" id="progress-bar"></div>
      <div class="nav-buttons">
        <button id="prev-btn" aria-label="Anterior">
          <svg viewBox="0 0 24 24">
            <path d="M15.41 16.58L10.83 12l4.58-4.59L14 6l-6 6 6 6z" />
          </svg>
        </button>
        <button id="next-btn" aria-label="Próximo">
          <svg viewBox="0 0 24 24">
            <path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6z" />
          </svg>
        </button>
      </div>
      <div class="story-content" id="story-content">
        <div class="story-text" id="story-text"></div>
      </div>
    </div>

    <script>
      const stories = [
        {
          text: "Você já se perguntou por que a maioria desiste de ganhar dinheiro online?",
          image:
            "https://via.placeholder.com/720x1280/000000/FFFFFF?text=Story+1",
        },
        {
          text: "Existe um padrão invisível que faz 93% falharem nos primeiros 7 dias...",
          video: "https://www.w3schools.com/html/mov_bbb.mp4",
        },
        {
          text: "Mas e se você pudesse quebrar esse padrão com um método simples?",
          image:
            "https://via.placeholder.com/720x1280/222222/FFFFFF?text=Story+3",
        },
        {
          text: "Conheça o Método das Marcas Digitais — usado até por quem nunca vendeu nada antes.",
          image:
            "https://via.placeholder.com/720x1280/333333/FFFFFF?text=Story+4",
        },
        {
          text: "Veja o que a Amanda disse após aplicar o método: 'Faturei R$2.300 em 5 dias!'",
          image:
            "https://via.placeholder.com/720x1280/444444/FFFFFF?text=Story+5",
        },
        {
          text: "Funciona mesmo se você não tiver seguidores, experiência ou produto próprio.",
          image:
            "https://via.placeholder.com/720x1280/555555/FFFFFF?text=Story+6",
        },
        {
          text: "Toque no botão abaixo para descobrir como aplicar esse método ainda hoje.",
          image:
            "https://via.placeholder.com/720x1280/666666/FFFFFF?text=Story+7",
          cta: true, // Adicionamos uma propriedade 'cta' para identificar a última história
        },
      ];

      const progressBar = document.getElementById("progress-bar");
      const storyContent = document.getElementById("story-content");
      const storyTextDiv = document.getElementById("story-text"); // Novo elemento para o texto
      const storyBackground = document.getElementById("story-background");
      const storyVideo = document.getElementById("story-video");
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");
      const storyContainer = document.getElementById("story-container");
      const navButtonsContainer = document.querySelector(".nav-buttons"); // Seleciona o contêiner dos botões de navegação

      let current = 0;
      let progressTimeout;

      function renderProgress() {
        progressBar.innerHTML = "";
        stories.forEach((_, index) => {
          const segment = document.createElement("div");
          segment.className = "progress-segment";
          const fill = document.createElement("div");
          fill.className = "progress-fill";

          if (index < current) {
            fill.style.width = "100%";
          } else if (index === current) {
            clearTimeout(progressTimeout);
            progressTimeout = setTimeout(() => {
              fill.style.width = "100%";
            }, 50);
          }

          segment.appendChild(fill);
          progressBar.appendChild(segment);
        });
      }

      function renderStory() {
        const story = stories[current];
        storyTextDiv.innerHTML = story.text; // Atribui o texto ao novo div

        storyVideo.pause();
        storyVideo.currentTime = 0;

        // Remove o botão CTA existente antes de adicionar um novo
        const existingCtaButton = storyContent.querySelector(
          ".cta-button-wrapper"
        );
        if (existingCtaButton) {
          existingCtaButton.remove();
        }

        if (story.video) {
          storyBackground.style.display = "none";
          storyVideo.src = story.video;
          storyVideo.style.display = "block";
          storyVideo.oncanplaythrough = () => {
            storyVideo
              .play()
              .catch((e) => console.error("Erro ao tentar tocar o vídeo:", e));
          };
        } else {
          storyVideo.style.display = "none";
          storyBackground.style.display = "block";
          storyBackground.style.backgroundImage = `url(${story.image})`;
        }

        if (story.cta) {
          // Verifica se é a história com CTA
          // Oculta os botões de navegação lateral
          navButtonsContainer.style.display = "none";

          // Cria o botão CTA e o adiciona no story-content
          const ctaButtonWrapper = document.createElement("div");
          ctaButtonWrapper.className = "cta-centered-container";
          ctaButtonWrapper.innerHTML = `<a href="https://sualandingpage.com" class="cta-button">Ver Método</a>`;
          storyContent.appendChild(ctaButtonWrapper);

          clearTimeout(progressTimeout); // Para a barra de progresso no último slide
        } else {
          // Mostra os botões de navegação lateral
          navButtonsContainer.style.display = "flex";
        }

        renderProgress();
      }

      nextBtn.addEventListener("click", () => {
        if (current < stories.length - 1) {
          current++;
          renderStory();
        } else {
          // Se já está na última história e é clicado, navega para a landing page
          window.location.href = "https://sualandingpage.com";
        }
      });

      prevBtn.addEventListener("click", () => {
        if (current > 0) {
          current--;
          renderStory();
        }
      });

      let touchStartX = 0;
      let touchEndX = 0;

      storyContainer.addEventListener("touchstart", (e) => {
        touchStartX = e.changedTouches[0].screenX;
      });

      storyContainer.addEventListener("touchend", (e) => {
        touchEndX = e.changedTouches[0].screenX;
        // Adicionado a condição para que o swipe não ative o CTA
        if (!stories[current].cta) {
          if (touchEndX < touchStartX - 50) {
            nextBtn.click();
          }
          if (touchEndX > touchStartX + 50) {
            prevBtn.click();
          }
        }
      });

      renderStory();
    </script>
  </body>
</html>
